<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>@ViewBag.Title – приложение ASP.NET</title>
  @Styles.Render("~/Content/css")
  @Scripts.Render("~/bundles/modernizr")
</head>

<body>
  <div class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
      <div class="btn-group" role="group" aria-label="...">
        @Html.ActionLink("Управление тестами", "Index", "TestManagement", new { area = "" }, new { @class = "btn btn-default" })
        @Html.ActionLink("Тестирование", "Index", "Testing", new { area = "" }, new { @class = "btn btn-default" })
        @Html.ActionLink("Статистика", "Index", "Statistics", new { area = "" }, new { @class = "btn btn-default" })
      </div>
    </div>
  </div>

  <div class="container body-content">
    @RenderBody()
    <hr />
    <footer>
      <p>&copy; @DateTime.Now.Year – приложение ASP.NET</p>
    </footer>
  </div>

  @Scripts.Render("~/bundles/jquery")
  @Scripts.Render("~/bundles/bootstrap")
  @RenderSection("scripts", required: false)
  
  <script type="text/javascript">
    let _CurrentContext = {
      DataModels: {
        Dict: {
          Questions: null,
          Answers: {}
        }
      }
    };
    //select.options[select.selectedIndex].value

    $(document).ready(function () {
      PreparePageCreateTest(_CurrentContext);
    });

    // Подготовить страницу создания теста.
    function PreparePageCreateTest(CurrentContext) {
      $('#selectboxquestions').ready(function () {
        GetAllQuestions(CurrentContext);
        console.log(CurrentContext.DataModels.Questions[0]);
        ShowQuestionsFormCreateTest(CurrentContext.DataModels.Dict.Questions);
      });

      $("#btn_addquestion").click(function () {
        $.ajax({
          type: "POST",
          url: '/TestManagement/AddQuestion', //your action
          data: $('#createtestmodel').serialize(), //your form name.it takes all the values of model
          dataType: 'json',
          success: function (result) {
            //console.log(result);
          }
        }).done(function (res) {
          location.reload();
        });
        return false;
      });

      $("#btn_savetest").click(function () {
        $.ajax({
          type: "POST",
          url: '/TestManagement/SaveNewTest', //your action
          data: $('#createtestmodel').serialize(), //your form name.it takes all the values of model
          dataType: 'json',
          success: function (result) {
            //console.log(result);
          }
        }).done(function (res) {
          $('#createtestmodel').html(res);
        });
        return false;
      });
    }

    // Получить список всех квестов.
    function GetAllQuestions(CurrentContext) {
      $.ajax({
        url: '/TestManagement/GetQuestions',
        type: 'GET',
        dataType: 'json',
        success: function (data) {
          CurrentContext.DataModels.Dict.Questions = data;
        }
      });
    }

    function ShowQuestionsFormCreateTest(Questions) {
      var _strResult = "";

      _strResult += '<select name="questions" id="questions">'
      $.each(Questions, function (index, Question) {
        _strResult += '<option value="' + Question.Id + '">' + Question.Text + '</option>';
      });
      _strResult += '</select>'

      $("#selectboxquestions").html(_strResult);
    }
  </script>
</body>
</html>